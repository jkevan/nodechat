<html>
<head>
	<script src="/socket.io/socket.io.js"></script>
	<script type="text/javascript" src="http://code.jquery.com/jquery-1.8.2.js"></script>
	<script>
		var socket = io.connect('http://localhost');
		var connected = false;
		var room;
		var nick;
        socket.on('connect', function(){
			
			$("#console").text("");
			if(!connected)
			{
				do{
					nick = prompt("Saisissez votre pseudo");
					room = prompt("Saisissez votre ChatRoom");
				}while(!nick && !room)
				socket.emit("add_user", nick, room);
				connected = true;
				$("#warn_con").hide();
				$("#form_send").removeAttr("hidden");
				$("#channel").text(room);
				$("#nickname").text(nick);
			}
        });

        socket.on('update_console', function(nickname, msg){
            $("#console").append('<b>'+ nickname + ':</b> ' + msg + '<br>')
        });
		
		socket.on('new_room', function(channel){
            $("#console").text('');
			$("#channel").text(channel);
			room = channel;
        });

        socket.on('update_users', function(data){
            $('#users').empty();
            $.each(data, function(key, value) {
                $('#users').append('<div>' + value + '</div>');
            });
        });

        $(function(){
            $('#send').click( function() {
                var msg = $('#msg').val();
                $('#msg').val('');
                socket.emit('send_msg', msg, room);
            });

            $('#msg').keypress(function(e) {
                if(e.which == 13) {
                    $(this).blur();
                    $('#send').focus().click();
                }
            });
        });
	</script>
</head>
<body>
<div id="warn_con" width="400" height="300">
<h3>Connexion au chat en cour ...</h3><br/>
<h3>Veuillez patienter</h3>
</div>
<div id="form_send" hidden>
	<p id="console">

	</p>
    <div id="users">

    </div>
	<p>Room :<span id="channel">Non connecté</span></p>
	<p>Nickname :<span id="nickname">Non défini</span></p>
    <label for="msg">Message: </label><textarea rows="4" cols="50" id="msg" placeholder="Ecrivez votre message ..."></textarea>
    <input type="button" value="send" id="send">
</div>
</body>
</html>