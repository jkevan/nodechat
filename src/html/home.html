<html>
<head>
	<script src="/socket.io/socket.io.js"></script>
	<script type="text/javascript" src="http://code.jquery.com/jquery-1.8.2.js"></script>
	<script>
		var socket = io.connect('http://localhost');
		var connected = false;
		var room;
		var nick;
        socket.on('connect', function(){
			$("#console").text("");
			if(!connected)
			{
				do{
					nick = prompt("Saisissez votre pseudo");
					room = prompt("Saisissez votre ChatRoom");
				}while(!nick && !room)
				socket.emit("add_user", nick, room);
				connected = true;
				$("#send").removeAttr("disabled");
			}
        });

        socket.on('update_console', function(nickname, msg){
            $("#console").append('<b>'+ nickname + ':</b> ' + msg + '<br>')
        });

        socket.on('update_users', function(data){
            $('#users').empty();
            $.each(data, function(key, value) {
                $('#users').append('<div>' + key + '</div>');
            });
        });

        $(function(){
            $('#send').click( function() {
                var msg = $('#msg').val();
                $('#msg').val('');

                socket.emit('send_msg', msg, room);
            });

            $('#msg').keypress(function(e) {
                if(e.which == 13) {
                    $(this).blur();
                    $('#send').focus().click();
                }
            });
        });
	</script>
</head>
<body>
	<p id="console">

	</p>
    <div id="users">

    </div>
    <label for="msg">message: </label><input type="text" width="90" id="msg">
    <input type="button" value="send" id="send" disabled>
</body>
</html>