<html>
<head>
	<script src="/socket.io/socket.io.js"></script>
	<script type="text/javascript" src="http://code.jquery.com/jquery-1.8.2.js"></script>
	<script>
		var socket = io.connect('http://localhost');
		var connected = false;
		var room;
		var nick;

        socket.on('update_console', function(nickname, msg){
            $("#console").append('<b>'+ nickname + ':</b> ' + msg + '<br>')
        });
		
		socket.on('new_room', function(channel){
            $("#console").text('');
			$("#channel").text(channel);
			room = channel;
        });

        socket.on('update_users', function(data){
            $('#users').empty();
            $.each(data, function(key, value) {
                $('#users').append('<div>' + value + '</div>');
            });
        });

        $(function(){
            $('#connect').click(function(){
                var nickname = $('#desired_nickname').val();
                var channel = $('#desired_channel').val();
                if(nickname && channel){
                    room = channel;
                    nick = nickname;
                    socket.emit("add_user", nickname, channel);

                    $("#form_connect").hide();
                    $("#form_send").show();
                    $("#channel").text(channel);
                    $("#nickname").text(nickname);
                }
            });

            $('#send').click( function() {
                var msg = $('#msg').val();
                $('#msg').val('');
                socket.emit('send_msg', msg, room);
            });

            $('#msg').keypress(function(e) {
                if(e.which == 13) {
                    $(this).blur();
                    $('#send').focus().click();
                }
            });
        });
	</script>
</head>
<body>
<div id="form_connect">
    <label for="desired_nickname">pseudo: </label><input type="text" id="desired_nickname">
    <label for="desired_channel">room: </label><input type="text" id="desired_channel">
    <input type="button" id="connect">
</div>

<div id="form_send" style="display: none">
	<p id="console">

	</p>
    <div id="users">

    </div>
	<p>Room :<span id="channel">Non connect�</span></p>
	<p>Nickname :<span id="nickname">Non d�fini</span></p>
    <label for="msg">Message: </label><textarea rows="4" cols="50" id="msg" placeholder="Ecrivez votre message ..."></textarea>
    <input type="button" value="send" id="send">
</div>
</body>
</html>